我是第一次完整写C#的程序，由于C#是在C++基础上改进的语言，故而我自认为还是可以圆满完成这个任务的。


- [准备](#1-准备)
- [题目](#2-题目)
- [要求](#3-要求)
    - [设计模式](#31-设计模式)
        - [模板方法模式](#311-模板方法模式)
        - [代理模式](#312-代理模式)
    - [UML图示](#32-uml图示)
        - [作图工具](#321-作图工具)
        - [类图的设计](#322-类图的设计)
        - [时序图](#323-时序图)
- [设计文档](#4-设计文档)
    - [数据库的设计](#41-数据库的设计)
    - [数据操作接口和类](#42-数据操作接口和类)
    - [窗口类](#43-窗口类)
- [实战](#5-实战)
- [常见问题](#6-常见问题)

----

## 1. 准备

- 首先安装好IDE工具[Visual Studio](https://visualstudio.microsoft.com/zh-hans/vs/)
- 下载并配置好MySQL数据库（推荐使用XAMPP或WampServer这样的整合软件包来安装，具体参见[实战部分](#5-实战)我的记录）
- 下载MySQL的.NET Connector

## 2. 题目

用C#实现一个小型连锁超市的**库存管理**，连锁超市在全国可能有多个仓库，可以查询指定仓库的商品库存情况，实现以下功能：

- 商品信息管理（增删改查）
> 商品编号+ 名称+类型+单价+计量单位+数量

- 货架信息管理（增删改查）
> 货架编号+总层数

- 仓库信息管理（增删改查）
> 仓库编号+地址

- 商品出库/入库管理
- 查询库存数量前三名的商品              
- 统计指定仓库所有商品总价值       
- 录入及修改后的数据需保存到本地文件或数据库

## 3. 要求

需要注意的要求有两个：

- 采用一到两种**设计模式** 
- UML画系统的**类图**和入库的**时序图**

----

### 3.1. 设计模式

非科班的我对[设计模式](http://www.runoob.com/design-pattern/design-pattern-tutorial.html)的理解，只停留在走马观花地看了一遍《设计模式之禅》、知道设计模式有23种之多的程度上。

#### 3.1.1. 模板方法模式

看看这个项目，使用到**模板方法模式**是肯定的，因为毕竟仅仅是使用类的继承机制，就符合模板方法模式的定义：

> Template Method Pattern. Define the skeleton of an algorithm in an operation, deferring some steps to subclasses. Template Method lets subclasses redefine certain steps of an algorithm without changing the algorithm's structure.

#### 3.1.2. 代理模式

此外，使用**代理模式**应该也不容置疑。它是一个使用率非常高的模式，提供访问控制。定义如下

> Proxy Pattern. Provide a surrogate or placeholder for another object to control access to it.

根据《设计模式之禅》，代理模式有3个角色：

- Subject抽象主题角色
- RealSubject具体主题角色
- Proxy代理主题角色

Proxy负责对真实角色的应用，把所有Subject定义的方法**限制委托**给RealSubject角色实现，并且在RealSubject处理过程的前后做预处理和善后处理。

----

### 3.2. UML图示

软件工程是系统性极强的，**统一建模语言(UML)**可以帮助软件开发者们梳理系统的各种逻辑。

非科班的我看了《构建之法》和《UML2与Rose建模从入门到精通》，大致知道怎么回事。

#### 3.2.1. 作图工具

- 听说Rose是主流的画UML图的工具软件，可是网上破解版都是2007版，太旧。
- Visio是office系列的软件，周围人用的多些。
- 但我还是喜欢很简洁的在线作图网站[ProcessOn](https://www.processon.com/)，因为在哪都可以用。

#### 3.2.2. 类图的设计

待填坑

#### 3.2.3. 时序图

待填坑

----

## 4. 设计文档

程序没做完，不过没时间做了。**可以去B站看我录的[演示视频](https://www.bilibili.com/video/av48974172)**，不但对程序能有个大致印象，自己下来源码也可以按我的操作来运行。

大致说一下我的程序设计方案：

----

### 4.1. 数据库的设计

先对商品、仓库、货架3个实体分别建立表格。其中又有如下的关系：**商品从属于货架，货架从属于仓库。**

于是把仓库（warehouse）设置为父表。货架（shelves）是子表，拥有外键，以关联父表。

至于商品（goods），有两种情况：

- 抽象的商品，仅作为商品信息的声明，不涉及商品如何存放
- 具体的商品，记录了有多少件商品、存放位置在哪里

一开始我是按前一种方式设计商品表的……后来发现应该用第二种，所以**我又增加了一个表，记录出入库操作**——某仓库的某货架，取走或者放入了多少件的某种商品。（goods_store表）

这样的设计很失败，goods_store表永远只会有insert插入，不会更新和删除。**记住这个教训，大家不要学我……**

----

### 4.2. 数据操作接口和类

当我看到一连3个“增删改查”，便想写个抽象的**接口**（我把它命名为InterfaceSQL类）。

这个接口有5个实现。前4个分别针对数据库里的4张表格，是**具体执行者**；

剩下1个类是**代理者**（Proxy类）。具体场景中，程序想操作数据库都会让代理者来干。

代理者内部会进行数据库的连接、断开；会指定具体执行者是谁。

----

### 4.3. 窗口类

继承自Form的类，用来显示wondows窗口。在VS中添加窗口类，然后打开工具箱拖拖控件、布布局就行了。对一个只有一两个窗口的demo来说，没什么特别需要注意的。

值得一提的是我发现dataGridView控件的强大之后，后来增删改查代码都懒得写了。

----

## 5. 实战

写完如上的文章之后，又隔了四五天时间（忙其他事情），我正式开始做任务了。

首先我用一下午的时间，**挑重点地学习了一遍C#语言，做了一点[笔记](https://wushuangabao.github.io/CSharp/CSharpLanguage)**。

然后直接开始着手写WinForm程序了。因为之前写过C#的AutoCAD插件，所以貌似速度还可以，只是MySQL的使用方法花了点时间去学习：

在GitHub上clone了一个用到MySQL的C#项目，看着它的源码，边看边google那些不明含义的方法，差不多懂了。

具体**实战中有很多犯错的地方，也[记录了下来](https://wushuangabao.github.io/CSharp/UseMySql)**。

第三天（4月11日）中午，任务已经差不多完成了70%，由于我还有研究生项目和社会上的兼职工作要做，就暂停了，半成品的整个工程已上传至本目录。

## 6. 常见问题

**网龙-庄煜老师：**我批改了几份作业，这里总结一下几个比较常见的问题：

**1.获取用户输入后没有对输入的内容进行判断**

为了增加程序的健壮性，获取用户输入后应对输入内容进行判断，比如判断是否空值，不能全部交给try-catch

**2.执行一次SQL命令就实例化一次SQLCommand类**

对于工具类应保证一个程序中只实例化一次，建议用单例模式实现。多次实例化会造成性能的浪费。

**3.变量命名问题**

应把成员变量和局部变量的命名规则区分开来，增加代码可读性。如：成员变量m_name, 静态变量s_name, CONST变量t_name

**4.对面向对象的理解不够深或有偏差**

例如：不应该让商品类继承货架类，让货架类继承仓库类。需要结合一些案例加深下理解，要弄明白什么时候用组合，什么时候用继承
